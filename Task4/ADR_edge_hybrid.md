### **Название задачи:** 
Выбор архитектурного решения — Гибридная Edge‑Cloud архитектура (оценка по критериям)

### **Автор:**
Rinat Muhamedgaliev

### **Дата:**
12.08.2025

### **Функциональные требования**
Ключевые сценарии (см. Task1/ADR.md):
- Обнаружение критических событий и уведомления < 5 сек
- Управление кормлением/поением, учёт поголовья, мониторинг оборудования
- Работа без интернета на ферме с последующей синхронизацией ≤ 10 минут
- API для мобильного и веб‑приложений, интеграция с ERP/BI

### **Нефункциональные требования**
- Время реакции: < 5 сек (видеоаналитика — миллисекунды)
- Надёжность: 99,95%
- Масштабируемость по числу ферм/агентов
- Возможность добавлять функции без ломки существующих
- Безопасность, мониторинг, удалённые обновления агентов

### **Решение**
Гибридная архитектура: критически важные функции работают на локальных агентах (видеоаналитика, управление оборудованием), сбор и интеграция — в центральной части (см. Task2/ADR.md для C2 и Task3/README.md для C3/C4). Обмен — очереди сообщений (Kafka/MQTT), вход — API‑шлюз Caddy, хранилища — PostgreSQL/SQLite (на агенте) и PostgreSQL/ClickHouse (в центре).

#### Критерии сравнения и веса
| № | Критерий | Вес |
|:-:|:--|:-:|
| 1 | Время реакции на критические события | 15% |
| 2 | Автономность (работа без интернета) | 15% |
| 3 | Стоимость (общая) | 10% |
| 4 | Сложность внедрения и поддержки | 10% |
| 5 | Масштабируемость | 10% |
| 6 | Возможности AI | 10% |
| 7 | Надёжность | 10% |
| 8 | Поддержка и мониторинг | 5% |
| 9 | Безопасность и соответствие | 5% |
| 10 | Скорость запуска MVP | 5% |
| 11 | Зависимость от поставщика | 5% |

Шкала: 1 — плохо, 5 — отлично.

#### Оценка по критериям
| Критерий | Оценка | Пояснение |
|:--|:--:|:--|
| Время реакции | 5 | Локальная обработка даёт минимальную задержку (мс) |
| Автономность | 5 | Полноценная работа без интернета, потом синхронизация |
| Стоимость | 3 | Выше разовые затраты (агенты), ниже ежемесячные расходы |
| Сложность внедрения | 2 | Много агентов, конфигураций, удалённые обновления |
| Масштабируемость | 4 | Легко наращивать фермы, сложнее управлять парком |
| Возможности AI | 3 | Ресурсы агента ограничены; часть задач можно отдавать в центр |
| Надёжность | 4 | Сеть не критична; возможен отказ отдельного агента |
| Поддержка и мониторинг | 3 | Нужен сквозной мониторинг между агентом и центром |
| Безопасность и соответствие | 4 | mTLS, управление устройствами, сегментация |
| Скорость запуска MVP | 2 | Дольше: нужно делать и агент, и центр |
| Зависимость от поставщика | 4 | Низкая: опора на открытые технологии |

Примерная итоговая оценка: ≈ 3,9/5.

### **Альтернативы**
- Централизованная Cloud‑архитектура (см. ADR_cloud_centralized.md)

### **Недостатки, ограничения, риски**
- Сложнее внедрять и поддерживать много агентов
- Разовые затраты на оборудование (в т.ч. GPU), нужно организовать обновления
- Ограниченные ресурсы на агенте для самых тяжёлых моделей

Как уменьшить риски: стандартизировать удалённые обновления, использовать систему управления парком, резервировать критичные узлы, при наличии связи отдавать тяжёлые задачи в центр.

### **Резюме и рекомендация**
Рекомендуется как целевое состояние для промышленной эксплуатации: даёт нужную скорость и автономность. Для MVP лучше начать с облака и затем перейти к гибриду по этапам (см. Task4/ADR_cloud_centralized.md).
